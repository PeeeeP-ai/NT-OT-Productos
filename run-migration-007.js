const fs = require('fs');
const path = require('path');

// Leer la migraciÃ³n
const migrationPath = path.join(__dirname, 'supabase-migrations', '007_fix_product_analyses_structure.sql');
const migrationSQL = fs.readFileSync(migrationPath, 'utf8');

console.log('ğŸ”§ Ejecutando MigraciÃ³n 007: CorrecciÃ³n de estructura de anÃ¡lisis de productos');
console.log('================================================================================');
console.log();
console.log('ğŸ“‹ Esta migraciÃ³n realiza los siguientes cambios:');
console.log('   âœ… Elimina la columna work_order_item_id de product_analyses');
console.log('   âœ… Agrega columna description opcional');
console.log('   âœ… Actualiza la funciÃ³n get_work_order_analyses');
console.log('   âœ… Limpia Ã­ndices obsoletos');
console.log();
console.log('ğŸ“„ CONTENIDO DE LA MIGRACIÃ“N:');
console.log('================================================================================');
console.log(migrationSQL);
console.log('================================================================================');
console.log();
console.log('ğŸ“‹ INSTRUCCIONES:');
console.log('1. Ve a tu proyecto de Supabase');
console.log('2. Abre el SQL Editor');
console.log('3. Copia y pega el SQL de arriba');
console.log('4. Ejecuta la consulta');
console.log();
console.log('âš ï¸ IMPORTANTE: Esta migraciÃ³n modifica la estructura de la tabla product_analyses');
console.log('   AsegÃºrate de que no haya datos importantes que dependan de work_order_item_id');
console.log();
console.log('ğŸ¯ RESULTADO ESPERADO:');
console.log('   âœ… Los anÃ¡lisis ahora serÃ¡n de la formulaciÃ³n completa');
console.log('   âœ… No se requiere selecciÃ³n de producto individual');
console.log('   âœ… Se agrega campo descripciÃ³n opcional');
console.log('   âœ… Funciones actualizadas para nueva estructura');
console.log();
console.log('ğŸ”„ DespuÃ©s de ejecutar la migraciÃ³n:');
console.log('   1. Reinicia el servidor proxy (node proxy-server.js)');
console.log('   2. El sistema funcionarÃ¡ correctamente sin selecciÃ³n de productos');
console.log();
console.log('ğŸš€ Â¡La migraciÃ³n estÃ¡ lista para ejecutar!');
